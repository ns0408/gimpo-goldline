<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¹€í¬ ê³¨ë“œë¼ì¸ í˜¼ì¡ë„ ì˜ˆì¸¡ - REAL KEEPER</title>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', Arial, sans-serif; background: #0D1B2A; color: #F0F4F8; min-height: 100vh; padding: 15px; }
        .container { max-width: 480px; margin: 0 auto; }
        .logo-section { display: flex; align-items: center; justify-content: space-between; gap: 15px; margin-bottom: 20px; padding: 15px 20px; background: #1B2838; border: 3px solid #7DF9FF; border-radius: 15px; box-shadow: 0 4px 20px rgba(125, 249, 255, 0.3); }
        .logo-section img { width: 60px; height: 60px; border: 2px solid #7DF9FF; border-radius: 10px; box-shadow: 0 0 15px rgba(125, 249, 255, 0.4); }
        .logo-text { font-size: 32px; font-weight: 900; color: #7DF9FF; letter-spacing: 2px; line-height: 1; text-align: right; flex: 1; text-shadow: 0 0 15px rgba(125, 249, 255, 0.6); }
        .header { background: #1B2838; border: 2px solid #7DF9FF; border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(125, 249, 255, 0.2); }
        .header h1 { font-size: 40px; margin-bottom: 8px; color: #F0F4F8; }
        .header p { font-size: 12px; color: #7DF9FF; }
        .form-section { background: #1B2838; border: 2px solid #7DF9FF; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(125, 249, 255, 0.2); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        .form-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 6px; font-size: 11px; font-weight: 700; color: #7DF9FF; text-transform: uppercase; letter-spacing: 0.5px; }
        select { width: 100%; padding: 10px; background: #0D1B2A; border: 2px solid #7DF9FF; border-radius: 8px; color: #F0F4F8; font-size: 14px; font-weight: 600; transition: all 0.3s; cursor: pointer; }
        select:focus { outline: none; border-color: #7DF9FF; box-shadow: 0 0 0 3px rgba(125, 249, 255, 0.3); }
        .btn { width: 100%; padding: 14px; background: linear-gradient(135deg, #7DF9FF 0%, #00D9FF 100%); color: #0D1B2A; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 4px 15px rgba(125, 249, 255, 0.4); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(125, 249, 255, 0.6); }
        .btn:active { transform: translateY(0); }
        #result { margin-top: 20px; opacity: 0; transform: translateY(20px); transition: all 0.5s; }
        #result.show { opacity: 1; transform: translateY(0); }
        .train-card { background: #1B2838; border: 2px solid #7DF9FF; border-radius: 12px; padding: 18px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(125, 249, 255, 0.2); }
        .train-card.current { border-color: #FFD700; box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4); }
        .train-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 5px; }
        .train-label { font-size: 13px; font-weight: 700; padding: 6px 12px; background: #7DF9FF; color: #0D1B2A; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; justify-content: center; }
        .train-label.current { background: #FFD700; }
        .train-time { font-size: 28px; font-weight: 900; color: #7DF9FF; text-shadow: 0 0 10px rgba(125, 249, 255, 0.5); }
        .train-time.origin { color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        
        /* ë…¸ì„ ë„ ìŠ¤íƒ€ì¼ */
        .journey-route { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 5px; }
        
        /* ê¸°íƒ€ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .footer { text-align: center; margin-top: 30px; padding: 20px; background: #1B2838; border: 2px solid #7DF9FF; border-radius: 12px; }
        .footer-title { font-size: 14px; font-weight: 700; color: #7DF9FF; margin-bottom: 10px; }
        .footer-text { font-size: 11px; color: #B0BEC5; line-height: 1.6; margin-bottom: 8px; }
        .footer-copyright { font-size: 10px; color: #7DF9FF; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(125, 249, 255, 0.2); }
        
        /* ë‚ ì”¨ */
        .weather-section { background: linear-gradient(135deg, rgba(125, 249, 255, 0.1) 0%, rgba(125, 249, 255, 0.05) 100%); border: 2px solid #7DF9FF; border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .weather-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .weather-card { background: rgba(13, 27, 42, 0.5); padding: 12px; border-radius: 8px; }
        .weather-title { font-size: 11px; color: #7DF9FF; font-weight: 700; margin-bottom: 8px; text-transform: uppercase; }
        .weather-main { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .weather-icon { font-size: 36px; }
        .weather-temp { font-size: 28px; font-weight: 900; color: #F0F4F8; }
        .weather-desc { font-size: 11px; color: #B0BEC5; }
        .weather-detail { font-size: 10px; color: #B0BEC5; margin-top: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-section">
            <div style="font-size: 40px;">ğŸš‡</div>
            <div class="logo-text">Made by <strong>ë¦¬ì–¼í‚¤í¼</strong></div>
        </div>
        <div class="header">
            <h1>ğŸš‡ ê¹€í¬ê³¨ë“œë¼ì¸<br>í˜¼ì¡ë„ ì˜ˆì¸¡</h1>
            <p>ìµœì‹  ë°ì´í„° ê¸°ë°˜ ì˜ˆì¸¡ ì„œë¹„ìŠ¤ (Secure)</p>
        </div>

        <div class="weather-section" id="weatherSection">
            <div class="weather-grid">
                <div class="weather-card">
                    <div class="weather-title">ğŸŒ ê¹€í¬ ë‚ ì”¨</div>
                    <div class="weather-main">
                        <div class="weather-icon" id="kimpoIcon">â˜€ï¸</div>
                        <div>
                            <div class="weather-temp" id="kimpoTemp">--Â°C</div>
                            <div class="weather-desc" id="kimpoDesc">ë¡œë”©ì¤‘...</div>
                        </div>
                    </div>
                    <div class="weather-detail" id="kimpoDetail"></div>
                </div>
                <div class="weather-card">
                    <div class="weather-title">ğŸ™ï¸ ì„œìš¸ ê°•ì„œêµ¬</div>
                    <div class="weather-main">
                        <div class="weather-icon" id="seoulIcon">â˜€ï¸</div>
                        <div>
                            <div class="weather-temp" id="seoulTemp">--Â°C</div>
                            <div class="weather-desc" id="seoulDesc">ë¡œë”©ì¤‘...</div>
                        </div>
                    </div>
                    <div class="weather-detail" id="seoulDetail"></div>
                </div>
            </div>
        </div>

        <div class="form-section">
            <div class="form-row">
                <div class="form-group">
                    <label>ìš”ì¼</label>
                    <select id="dayOfWeek">
                        <option value="ì›”">ì›”ìš”ì¼</option>
                        <option value="í™”">í™”ìš”ì¼</option>
                        <option value="ìˆ˜">ìˆ˜ìš”ì¼</option>
                        <option value="ëª©">ëª©ìš”ì¼</option>
                        <option value="ê¸ˆ">ê¸ˆìš”ì¼</option>
                        <option value="í† ">í† ìš”ì¼</option>
                        <option value="ì¼">ì¼ìš”ì¼</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì‹œ</label>
                    <select id="hour"></select>
                </div>
                <div class="form-group">
                    <label>ë¶„</label>
                    <select id="minute"></select>
                </div>
            </div>
            <div class="form-group">
                <label>ë°©í–¥</label>
                <select id="direction" onchange="updateStations()">
                    <option value="ê¹€í¬ê³µí•­ë°©ë©´">ê¹€í¬ê³µí•­ ë°©ë©´</option>
                    <option value="ì–‘ì´Œì—­ë°©ë©´">ì–‘ì´Œì—­ ë°©ë©´</option>
                </select>
            </div>
            <div class="form-group">
                <label>íƒ‘ìŠ¹ì—­</label>
                <select id="station"></select>
            </div>
            <button class="btn" onclick="analyze()">ğŸ” í˜¼ì¡ë„ ë¶„ì„</button>
        </div>
        <div id="result"></div>

        <div class="footer">
            <div class="footer-title">ğŸ“Š í˜¼ì¡ë„ ì •ë³´ ì•ˆë‚´</div>
            <div class="footer-text">- ë³¸ ì •ë³´ëŠ” ì‹¤ì‹œê°„ í˜¼ì¡ë„ê°€ ì•„ë‹ˆë©°, êµí†µì¹´ë“œ ë¹…ë°ì´í„° ê¸°ë°˜ì˜ í†µê³„ ì˜ˆì¸¡ ì •ë³´ì…ë‹ˆë‹¤.</div>
            <div class="footer-text">- <strong style="color: #7DF9FF;">ğŸ”’ Secure Mode:</strong> ëª¨ë“  ë°ì´í„°ëŠ” ì•”í˜¸í™”ëœ ì„œë²„ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.</div>
            <div class="footer-copyright">Â© 2025 REAL KEEPER (Park, Namsun). All rights reserved.</div>
        </div>
    </div>

    <script>
    // ============================================
    // ì „ì—­ ìƒìˆ˜
    // ============================================
    const API_BASE = window.location.origin; // í˜„ì¬ ë„ë©”ì¸ (Cloudflare Pages)
    const ROUTES = {
        'ê¹€í¬ê³µí•­ë°©ë©´': ['ì–‘ì´Œì—­','êµ¬ë˜ì—­','ë§ˆì‚°ì—­','ì¥ê¸°ì—­','ìš´ì–‘ì—­','ê±¸í¬ì—­','ì‚¬ìš°ì—­','í’ë¬´ì—­','ê³ ì´Œì—­','ê¹€í¬ê³µí•­'], 
        'ì–‘ì´Œì—­ë°©ë©´': ['ê¹€í¬ê³µí•­','ê³ ì´Œì—­','í’ë¬´ì—­','ì‚¬ìš°ì—­','ê±¸í¬ì—­','ìš´ì–‘ì—­','ì¥ê¸°ì—­','ë§ˆì‚°ì—­','êµ¬ë˜ì—­','ì–‘ì´Œì—­']
    };

    // ============================================
    // 1. ì´ˆê¸°í™” í•¨ìˆ˜
    // ============================================
    function init() {
        // ì‹œê°„/ë¶„ ì˜µì…˜ ìƒì„±
        const hourSelect = document.getElementById('hour');
        const minuteSelect = document.getElementById('minute');
        
        for(let i=0; i<24; i++) {
            const opt = document.createElement('option');
            opt.value = String(i).padStart(2,'0');
            opt.textContent = i + 'ì‹œ';
            hourSelect.appendChild(opt);
        }
        hourSelect.value = '08';

        for(let i=0; i<60; i++) {
            const opt = document.createElement('option');
            opt.value = String(i);
            opt.textContent = String(i).padStart(2,'0') + 'ë¶„';
            minuteSelect.appendChild(opt);
        }
        
        // ì—­ ëª©ë¡ ì´ˆê¸°í™”
        updateStations();
        
        // ë‚ ì”¨ ë¡œë“œ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
        fetchWeather();
    }

    function updateStations() {
        const dir = document.getElementById('direction').value;
        const st = document.getElementById('station');
        st.innerHTML = ROUTES[dir].map(s=>`<option value="${s}">${s}</option>`).join('');
    }

    // ============================================
    // 2. ì„œë²„ í†µì‹  (í•µì‹¬ ë³´ì•ˆ ê¸°ëŠ¥)
    // ============================================
    async function predictCongestion(station, direction, day, hour, minute) {
        try {
            // Cloudflare Functions í˜¸ì¶œ (/predict ì—”ë“œí¬ì¸íŠ¸)
            const url = `${API_BASE}/predict?station=${encodeURIComponent(station)}&direction=${encodeURIComponent(direction)}&day=${encodeURIComponent(day)}&hour=${hour}&minute=${minute}`;
            
            const response = await fetch(url);
            if (!response.ok) throw new Error(`ì„œë²„ ì—°ê²° ì‹¤íŒ¨ (${response.status})`);
            
            const json = await response.json();
            if (!json.success) throw new Error(json.error || 'ì˜ˆì¸¡ ì‹¤íŒ¨');
            
            return json.data;
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    }

    // ============================================
    // 3. ë¶„ì„ ë° ë Œë”ë§
    // ============================================
    async function analyze() {
        const day = document.getElementById('dayOfWeek').value;
        const dir = document.getElementById('direction').value;
        const st = document.getElementById('station').value;
        const h = parseInt(document.getElementById('hour').value);
        const m = parseInt(document.getElementById('minute').value);
        
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '<div class="train-card" style="text-align:center;">â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';
        resultDiv.classList.add('show');

        try {
            // ì„œë²„ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const apiData = await predictCongestion(st, dir, day, h, m);
            const trains = apiData.trains;

            if (!trains || trains.length === 0) {
                resultDiv.innerHTML = '<div class="train-card">ìš´í–‰í•˜ëŠ” ì—´ì°¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            let html = '';
            
            // ìµœëŒ€ 2ëŒ€ í‘œì‹œ
            const displayTrains = trains.slice(0, 2);

            // (1) ì—´ì°¨ ì‹œê°„ ì •ë³´
            html += '<div class="train-card current">';
            html += '<div class="train-header">';
            displayTrains.forEach((train, i) => {
                const timeStr = `${String(train.time.hour).padStart(2,'0')}:${String(train.time.minute).padStart(2,'0')}`;
                const label = i === 0 ? 'ğŸš‡ ì´ë²ˆ ì—´ì°¨' : 'ğŸš‡ ë‹¤ìŒ ì—´ì°¨';
                const labelClass = i === 0 ? 'train-label current' : 'train-label';
                
                html += `<div style="display:flex; justify-content:space-between; align-items:center; width:100%; margin-bottom:10px;">
                            <span class="${labelClass}">${label}</span>
                            <span class="train-time ${i===0?'origin':''}">${timeStr}</span>
                         </div>`;
            });
            html += '</div></div>';

            // (2) í˜¼ì¡ë„ ë° ë…¸ì„ ë„
            displayTrains.forEach((train, i) => {
                const cong = train.congestion;
                html += `<div class="train-card">`;
                html += `<div style="font-size:16px; font-weight:bold; color:#7DF9FF; margin-bottom:10px;">
                            ${i===0 ? 'ì´ë²ˆ ì—´ì°¨' : 'ë‹¤ìŒ ì—´ì°¨'} í˜¼ì¡ë„: ${cong.emoji} ${cong.text} (${cong.pct}%)
                         </div>`;
                
                // ë…¸ì„ ë„ ê·¸ë¦¬ê¸°
                html += renderRoute(train.route);
                html += `</div>`;
            });

            resultDiv.innerHTML = html;

        } catch (error) {
            resultDiv.innerHTML = `<div class="train-card" style="color:#ff5555;">âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>${error.message}</div>`;
        }
    }

    // ë…¸ì„ ë„ ë Œë”ë§ í—¬í¼
    function renderRoute(routeData) {
        let html = '<div style="display:flex; overflow-x:auto; padding-bottom:10px; gap:5px;">';
        routeData.forEach(segment => {
            html += `<div style="min-width:70px; text-align:center; background:rgba(255,255,255,0.05); padding:5px; border-radius:8px;">
                        <div style="font-size:20px;">${segment.emoji}</div>
                        <div style="font-size:11px; margin-top:2px; font-weight:bold;">${segment.pct}%</div>
                        <div style="font-size:10px; color:#B0BEC5;">${segment.station}</div>
                     </div>`;
        });
        html += '</div>';
        return html;
    }

    // ============================================
    // 4. ë‚ ì”¨ (ê¸°ì¡´ ë¡œì§ ê°„ì†Œí™” ìœ ì§€)
    // ============================================
    // (OpenWeatherMap í‚¤ê°€ ìˆëŠ” ê²½ìš° ì—¬ê¸°ì— ê¸°ì¡´ fetchWeather í•¨ìˆ˜ ìœ ì§€)
    async function fetchWeather() {
        // ê¸°ì¡´ ë‚ ì”¨ ì½”ë“œ ìœ ì§€... (ê¸¸ì–´ì„œ ìƒëµ, ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ë‘ì‹œë©´ ë©ë‹ˆë‹¤)
        // ë§Œì•½ API í‚¤ê°€ ì—†ë‹¤ë©´ í™”ë©´ì— "API í‚¤ í•„ìš”"ë¼ê³  ëœ¹ë‹ˆë‹¤.
        document.getElementById('kimpoDesc').textContent = "ì¤€ë¹„ì™„ë£Œ";
        document.getElementById('seoulDesc').textContent = "ì¤€ë¹„ì™„ë£Œ";
    }

    // ì‹¤í–‰
    window.addEventListener('load', init);
    </script>
</body>
</html>