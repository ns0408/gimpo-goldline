name: ğŸ“Š ê¹€í¬ ê³¨ë“œë¼ì¸ ë°ì´í„° ìë™ ê°±ì‹  (V3.3 - 8 Models)

on:
  schedule:
    # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 4ì‹œ (UTC 19:00)ì— ì‹¤í–‰
    # (ëŒë°œ ìƒí™©ìœ¼ë¡œ ì–´ì œ ì‹¤íŒ¨í–ˆì–´ë„, ì˜¤ëŠ˜ ë‹¤ì‹œ ì „ì²´ë¥¼ ì½ì–´ ë³µêµ¬í•©ë‹ˆë‹¤)
    - cron: '0 19 * * *'
  workflow_dispatch:
    # ê¹ƒí—™ Action íƒ­ì—ì„œ 'ìˆ˜ë™ ì‹¤í–‰' í—ˆìš©

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ë ˆí¬ì§€í† ë¦¬ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. íŒŒì´ì¬ í™˜ê²½ ì„¤ì •
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. âš ï¸ [ìˆ˜ì •] íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (holidays ì¶”ê°€)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # ë°ì´í„° ì²˜ë¦¬(pandas), ë¨¸ì‹ ëŸ¬ë‹(sklearn), ê³µíœ´ì¼(holidays) ì„¤ì¹˜
          # requests ì¶”ê°€ë¨ (API í†µì‹ ìš© í•„ìˆ˜ ë„êµ¬)
          pip install pandas scikit-learn holidays requests
          # (í¬ë¡¤ë§ ì‹œ) pip install requests beautifulsoup4

      # 4. [TODO] data.go.kr í¬ë¡¤ë§ ë° íŒŒì¼ ë‹¤ìš´ë¡œë“œ
      - name: â¬‡ï¸ Download latest data file
        run: |
          # [TODO] 
          # data.go.kr í¬ë¡¤ë§ ë¡œì§ êµ¬í˜„ í•„ìš”
          # êµ¬í˜„ ì „ê¹Œì§€ëŠ” 'raw_data/' í´ë”ì— ìˆ˜ë™ìœ¼ë¡œ CSVë¥¼ ë„£ì–´ì£¼ì–´ì•¼ í•¨
          echo "Skipping download, using existing files in 'raw_data/'..."
          # (ì˜ˆì‹œ) curl "API_URL" -o "raw_data/new_data_$(date +%Y%m%d).csv"
          
      # 5. ë°ì´í„° íŒŒì‹± ë° 8ëª¨ë¸ ML ì˜ˆì¸¡ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      - name: âš™ï¸ Run ML prediction script (V3.3)
        run: |
          # 1ë‹¨ê³„ì—ì„œ ìƒì„±í•œ data/timetable.json ê³¼
          # 1ë‹¨ê³„ì—ì„œ 30ê°œ CSVë¥¼ ë„£ì€ raw_data/ í´ë”ê°€ ìˆë‹¤ê³  ê°€ì •
          python scripts/data_collector.py
          
      # 6. ê°±ì‹ ëœ data.json íŒŒì¼ì„ Gitì— ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: ğŸ’¾ Commit and push updated data.json
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          if [[ -n $(git status --porcelain data.json) ]]; then
            echo "Data changed. Committing..."
            git add data.json
            git commit -m "ğŸ“Š [AutoML V3.3] ê¹€í¬ ê³¨ë“œë¼ì¸ 8ëª¨ë¸ ì˜ˆì¸¡ ê°±ì‹ "
            git push
          else
            echo "No data changes detected."
          fi